<nav class="documentation-nav">
  {% assign pages = site.pages | sort: 'menu-order' %}
  {% for node in pages %}
  {% assign node_parts = node.url | split: '/' %}
  {% assign node_depth = node_parts | size %}

  {% if node_depth == 2 %}
  <div class="nav-group {% if page.url contains node.url %} active {% endif %}">
    <div class="nav-heading">
      <i class="material-icons">
        {% if page.url contains node.url %}
        keyboard_arrow_down
        {% else %}
        keyboard_arrow_right
        {% endif %}</i>
      <a {% if page.url contains node.url %} aria-current="page" class="active" {% endif %} href="{{ node.url }}">
        {{ node.title }}
      </a>
    </div>

    {% assign node_root = '/' | append: node_parts[1] | append: '/' %}
    {% assign has_children = false %}
    {% for subnode in pages %}
    {% if subnode.url contains node_root and subnode.url != node_root %}
    {% assign has_children = true %}
    {% endif %}
    {% endfor %}

    {% if has_children == true %}
    <ul>
      {% for subnode in pages %}
      {% if subnode.url contains node_root and subnode.url != node_root %}
      {% assign node_parts = subnode.url | split: '/' %}
      {% assign node_depth = node_parts | size %}

      {% if node_depth == 3 %}
      <li>
        <a {% if page.url contains subnode.url %} aria-current="page" class="active" {% endif %}
          href="{{ subnode.url }}">
          {{ subnode.title }} subnode title
        </a>
      </li>
      {% endif %}
      {% endif %}
      {% endfor %}
    </ul>
    {% endif %}
  </div>
  {% endif %}
  {% endfor %}
</nav>